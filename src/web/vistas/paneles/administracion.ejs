<!DOCTYPE html>
<html lang="es" data-id_usuario="<%- usuario.id_usuario %>" data-nombre="<%- usuario.nombre %>"
  data-apellido="<%- usuario.apellido %>" data-tipo_usuario="<%- usuario.tipo_usuario %>">

<head>
  <%- include('../parciales/head.html') %>
  <link rel="stylesheet" href="alertas.css" />
  <link rel="stylesheet" href="directivos.css">
  <link rel="stylesheet" href="/css/panel-administracion.css">

  <!-- ICONOS (Font Awesome) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <!-- SOCKET.IO -->
    <script type="module" src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@4.0.2/dist/timeago.min.js"></script>

    
</head>

<body>
  <div class="layout" id="layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="logo">
        <div class="logo-icon">A</div>
        <div class="logo-text">
          <h1>AukaTech</h1>
          <span>Panel de Monitoreo</span>
        </div>

      </div>

      <nav class="nav">
        <span>Navegación</span>
        <ul class="nav-list">
          <li>
            <a href="/panel/dashboard"><i class="fas fa-home"></i> <span>Dashboard</span></a>
          </li>
          <li>
            <a href="/panel/directivos"><i class="fas fa-phone-alt"></i> <span>Llamados</span></a>
          </li>
          <li class="active">
            <a href="/panel/administracion"><i class="fa-solid fa-gear"></i> <span>Administración</span></a>
          </li>
          <li>
            <a href="/panel/analisis"><i class="fa-solid fa-chart-column"></i>
              <span>Análisis</span></a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Contenido principal -->
    <div class="main-content" id="mainContent">
      <header class="header">
        <div class="menu-icon" id="menuIcon">
          <img src="img/icon.svg" alt="" />
        </div>
        <div class="logo1">
          <div class="logo-icon1">A</div>
          <span class="logo-text1">AukaTech</span>
        </div>
      </header>

      <main class="main-panel">
        <div class="header-llamados">
          <h2>Administracion del sistema</h2>
        </div>
        <div class="card-wide">
          <h3>
            <i class="fa-solid fa-file-export"></i> Exportación de Datos
          </h3>
          <p class="subtexto">
            Exportar listados de solicitudes en diferentes formatos
          </p>

          <div class="filters-row export-buttons">
            <button id="boton-exportar-excel" class="botones-exportar">
              <i class="fa-solid fa-file-excel"></i> Exportar a Excel
            </button>
            <button id="boton-exportar-pdf" class="botones-exportar">
              <i class="fa-solid fa-file-pdf"></i> Exportar a PDF
            </button>
            <button id="boton-exportar-csv" class="botones-exportar">
              <i class="fa-solid fa-file-csv"></i> Exportar a CSV
            </button>
            <button id="boton-exportar-reporte-completo" class="botones-exportar">
              <i class="fa-solid fa-file-lines"></i> Reporte Completo
            </button>
          </div>

          <div class="filters-row filtros-secundarios">
            <div class="filter-group">
              <span>Fecha de Inicio</span>
              <div class="filter">
                <i class="fa-regular fa-calendar"></i>
                <input type="date" id="fechaInicio" />
              </div>
            </div>

            <div class="filter-group">
              <span>Fecha de Fin</span>
              <div class="filter">
                <i class="fa-regular fa-calendar"></i>
                <input type="date" id="fechaFin" />
              </div>
            </div>

            <div class="filter-group">
              <span>Filtrar por Estado</span>
              <div class="filter">
                <i class="fa-solid fa-filter"></i>
                <select id="filtroEstado">
                  <option value="">Todos los estados</option>
                  <option value="pendiente">Pendiente</option>
                  <option value="completado">Finalizado</option>
                  <option value="cancelado">Cancelado</option>
                </select>
              </div>
            </div>
          </div>
        </div>



        <!-- Gestión de Usuarios Card -->
        <div class="card-wide">
          <h3><i class="fa-solid fa-user-group"></i> Gestión de Usuarios</h3>
          <p class="subtexto">Autorizar o desautorizar usuarios del sistema</p>

          <div class="users-table">
            <table>
              <thead>
                <tr>
                  <th>Usuario</th>
                  <th>Email</th>
                  <th>Rol</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <% if (usuarios && usuarios.length > 0) { %>
                  <% usuarios.forEach(usuario => { %>
                    <tr data-usuario-id="<%= usuario.id_usuario %>">
                      <td><%= usuario.nombre %> <%= usuario.apellido %></td>
                      <td><%= usuario.email %></td>
                      <td><%= usuario.tipo_usuario %></td>
                      <td class="estado-verificacion">
                        <span class="badge <%= usuario.autorizado ? 'bg-success' : 'bg-warning' %>">
                          <%= usuario.autorizado ? 'Verificado' : 'No verificado' %>
                        </span>
                      </td>
                      <td>
                        <button 
                          class="btn-verificar <%= usuario.autorizado ? 'btn-verificado' : 'btn-no-verificado' %>"
                          data-usuario-id="<%= usuario.id_usuario %>"
                          data-verificado="<%= usuario.autorizado %>"
                          title="<%= usuario.autorizado ? 'Haz clic para desverificar' : 'Haz clic para verificar' %>"
                        >
                          <i class="fas <%= usuario.autorizado ? 'fa-user-check' : 'fa-user-times' %>"></i>
                          <span><%= usuario.autorizado ? ' Desverificar' : ' Verificar' %></span>
                        </button>
                      </td>
                    </tr>
                  <% }) %>
                <% } else { %>
                  <tr>
                    <td colspan="5" class="text-center">No hay usuarios registrados</td>
                  </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
  </div>

  <div id="notificacion" class="alerta animate__animated animate__fadeInRight" style="display: none;">
    <i id="notificacionIcono"></i>
    <span id="notificacionMensaje"></span>
  </div>

  <div id="detalleLlamadoModal" class="modal-llamado" style="display: none">
    <div class="modal-llamado-content">
      <button class="modal-llamado-close" id="cerrarDetalleLlamado">
        &times;
      </button>
      <div id="detalleLlamadoContenido">
        <!-- Aquí se cargará el detalle dinámicamente -->
      </div>
    </div>
  </div>

  <!-- Scripts de exportación -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  
  <!-- Scripts de la aplicación -->
  <script src="js/panel/administracion.js"></script>
</body>
</html>